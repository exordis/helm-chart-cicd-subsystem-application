## Definition



=== "Values"

    ``` yaml
    --8<-- "snippets/values/ingresses.yaml"
    ```

=== "Ingress Manifests"

    ``` yaml
    --8<-- "snippets/manifests/Ingress/cicd-sample-docs-minimum.yml"
    ```

    <!---->

    ``` yaml
    --8<-- "snippets/manifests/Ingress/cicd-sample-docs-full.yml"
    ```

    <!---->

    ``` yaml
    --8<-- "snippets/manifests/Ingress/cicd-sample-docs-pure-spec.yml"
    ```



`namespace`

:   secret namespace

    **default:** subsystem namespace generated by convention

`labels`

:   list of labels to add to secret in addition to [common labels](../common metadata.md)

    **default:** empty dict

`annotations`

:   list of annotations to add to secret in addition to [common annotations](../common metadata.md)

    **default:** empty dict

`hosts`

:   lists of hosts. If `hosts` has item with some name, this name would be expanded to list when used as host on spec or service mapping

    `default`

    :   hosts from this list are used if `hosts` is not explicitly provided in service mapping or spec.rules

        
    **default:** `{ "default": ["default"] }`


`services`

:   Defines services mapping. Dict where key is service name and value

    `hosts`

    :   hosts to expose service on

        **default:** empty dict
    

    `ports`

    :   ports of service to expose and settings for them. key is service port name, values - list of rule overrides for service port

        **default:** expose all service ports on path matching port name e.g port `api`  would be exposed on path `/api` with `pathType: "Prefix"`

    **default:** empty dict

`tls`

:   Defines tls utilization

    `enabled`

    : Whether to use TLS

    **default:** true

    `secretName`

    : name of the secret for tls certificate

    **default:** namespace generated with [naming conventions](../naming conventions.md) with secret id equal to `<ingress id>-tls`

`spec`    

:   Ingress  kubernetes manifests `spec` field value. 

    **default:** empty 



### Minimum Viable Ingress Definition

- Default metadata
- single host `host1.local`
- Ingress exposes all service ports on paths matching service port name (single port `http` on path `/http`  )
- TLS is enabled and cert has single SAN `host1.local`
  
``` yaml

applicationContainer:
  spec:
    ports:
      - containerPort: 8080
        name: http  

services:
  minimum: 
    ports:
      http:

ingresses:
  minimum:
    services:
      minimum:
        hosts:
          - host1.local      
```

## Validations

- services referenced in `services` are defined in `values.services`
- ports referenced in `services.<service id>.ports` are defined for service with given id on `values.services`


## Overrides

`name`

:   generated with [naming conventions](../naming conventions.md) from ingress `id`

## Manifests Generation 

Ingress manifest is generated for each ingress.

- [common annotations](../common metadata.md) are added to metadata
- `spec` value is extended with rules generated from `services`
-  Resulting `spec` is processed with expansion of `spec.rules[].host` based on lists provided with `hosts` e.g. if some rule has host `myhosts` and `hosts.myhosts` is defined, the rule would be repeated for each value in `hosts.myhosts` as `host`

if `spec.tls` is not explicitly provided and `tls` is set to `true`, it is generated:

  - `spec.tls.hosts` contains all hosts referenced on `spec` in this case
  - annotation `nginx.ingress.kubernetes.io/force-ssl-redirect: "true"` is added
  - `tls.secretName` value is used as tls secret name



