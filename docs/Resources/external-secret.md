---
title: External Secret
---
## Definition

=== "Values"

    ``` yaml
    --8<-- "snippets/values/externalSecrets.yaml"
    ```

=== "ExternalSecret Manifest"

    ``` yaml
    --8<-- "snippets/manifests/deployment/ExternalSecret/cicd-sample-docs-external-full.yml"
    ```

=== "Deployment Manifest"

    ``` yaml
    --8<-- "snippets/manifests/deployment/Deployment/cicd-sample-docs.yml"
    ```

=== "CronJob Manifest"

    ``` yaml
    --8<-- "snippets/manifests/deployment/CronJob/cicd-sample-docs-cleanup.yml"
    ```

`enabled`

:   if set to false external secret is excluded from rendering

    **default:** true


`namespace`

:   external secret namespace

    **default:** subsystem namespace generated by convention

`labels`

:   list of labels to add to external secret and target secret in addition to [common labels](../common metadata.md)

    **default:** empty dict

`annotations`

:   list of annotations to add to external secret and target secret in addition to [common labels](../common metadata.md)

    **default:** empty dict

`containers`

:   list of container ids to add `secretRef` for the target secret. If  `containers` is not provided, `secretRef` would be added to all containers in secret namespace.
    Batch workloads should be referenced as `[workload collection].[workload id].[container id]` e.g `cronjobs.cleanup.main`


    **default:** nil (add `secretRef` to all containers)

`keys`

:   map of `targetKey -> remoteKey`. Simple shortcut for the case where list of external secret keys are to be passed with given key names to target secret 

    if `remoteKey` is nil it defaults to `targetKey` value

    **default:** empty dict

`spec`

:   ExternalSecret manifest `spec` field value (see [External Secrets Operator Documentation](https://external-secrets.io/latest/api/externalsecret/) for more details). 
    
    **default:**:
    ``` yaml
    secretStoreRef:
        name: [subsystem name]-[environment]
        kind: ClusterSecretStore    
    refreshInterval: 1m
    target:
      creationPolicy: Owner
      deletionPolicy: Retain
    data: []
    ```

### Minimum Viable External Secret Definition    

- Default metadata
- Single key `DB_LOGIN` from external provider is passed through to target secret keeping the  name

``` yaml

externalSecrets:
  simple:
    keys:
      DB_LOGIN:
      
```

## Validations

- External secret `id` is unique with respect to [secrets](secret.md) ids
- Each item in `containers` references existing container
- Each item in `containers` references container from the same namespace as external secret

## Overrides

`name`

:   `name` is generated from id by [convention](../naming conventions.md)


`spec`

:   `target.template.metadata.annotations` 

    :   common annotations are added with override, external secret  `.annotations` are added if same annotation is not explicitly redefined. 

    `target.template.metadata.labels`

    :   common labels are added with override, external secret `.labels` are added if same label is not explicitly redefined.

    `target.name`

    :   is set to [secret](secret.md) name generated from external secret `id` by [convention](../naming conventions.md)

    `secretStoreRef`

    :   generated to point subsystem `ClusterSecretStore` ( `name` is generated from `id=""` by [convention](../naming conventions.md) )

    `target.template.templateFrom[].configMap.name`

    :    is expanded to full [ConfigMap](configmap.md) name if references `id` of [ConfigMap](configmap.md) defined in values


### Manifest Generation

- [common labels](../common metadata.md) are added to metadata
- `ExternalSecret` manifest is generated for each defined external secret. 
- `secretRef` is added for target secret to containers with ids listed in `.containers` (all if this field is not set)
