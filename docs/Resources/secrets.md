## Definition


``` yaml
secrets:
  secret1:
    # defaults to application namespace based on convention
    namespace: "my-namespace"
    # defaults to empty dict
    labels: 
      extra-label: "label value"
    # defaults to empty dict
    annotations: 
      extra-annotation: "annotation value"
    stringData:
      password: "passw0rd" 
  secret2:
    containers: 
      - applicationContainer
      - cronjobs.cleanup.main
    stringData:
      password: "passw0rd" 
```


`namespace`

:   secret namespace

    **default:** subsystem namespace generated by convention

`labels`

:   list of labels to add to secret in addition to [common labels](../common metadata.md)

    **default:** empty dict

`annotations`

:   list of annotations to add to secret in addition to [common annotations](../common metadata.md)

    **default:** empty dict

`containers`

:   list of container ids to add `secretRef` for the secret. If  `containers` is not provided, `secretRef` would be added to all containers in secret namespace.
    Batch workloads should be referenced as `[workload collection].[workload id].[container id]` e.g `cronjobs.cleanup.main`


    **default:** nil (add `secretRef` to all containers)

`stringData`

:   `stringData` to be added to secret manifest

    **default:** empty dict

## Validations

- Secret `id` is unique with respect to [external secrets](external-secret.md) ids
- Each item in `containers` references `applicationContainer` or existing `id` in `init-container` or `sidecars`
- Each item in `containers` belongs to the same some-namespace as the secret

## Overrides

`name`

:   `name` is generated from id by [convention](../naming conventions.md)


## Manifests Generation 

- `secretRef` is added to containers with ids listed in `secret.containers` (all if this field is not set)
- annotation with checksum of configmap is added to workloads manifests if at least one container of has `secretRef` added
- secret manifest is generated
 
    ``` yaml
    ---
    apiVersion: v1
    kind: Secret
    metadata:
      name: some-subsystem-some-application-some-instance-secret1
      namespace: my-namespace
      labels:
          app.kubernetes.io/component: some-subsystem-some-application
          app.kubernetes.io/instance: some-instance
          app.kubernetes.io/managed-by: helm
          app.kubernetes.io/name: some-subsystem-some-application
          app.kubernetes.io/part-of: some-subsystem
          app.kubernetes.io/version: 0.0.0
          exordis/application: some-subsystem-some-application
          exordis/application-instance: some-instance
          exordis/application-type: service
          exordis/environment: test
          exordis/product: Some Product
          exordis/subsystem: some-subsystem
          extra-label: label value
          helm.sh/chart: cicd-subsystem-application-0.1.0
      annotations:
          extra-annotation: annotation value
    stringData:
      password: passw0rd
    ---
    apiVersion: v1
    kind: Secret
    metadata:
      name: some-subsystem-some-application-some-instance-secret2
      namespace: some-subsystem-test
      labels:
          app.kubernetes.io/component: some-subsystem-some-application
          app.kubernetes.io/instance: some-instance
          app.kubernetes.io/managed-by: helm
          app.kubernetes.io/name: some-subsystem-some-application
          app.kubernetes.io/part-of: some-subsystem
          app.kubernetes.io/version: 0.0.0
          exordis/application: some-subsystem-some-application
          exordis/application-instance: some-instance
          exordis/application-type: service
          exordis/environment: test
          exordis/product: Some Product
          exordis/subsystem: some-subsystem
          helm.sh/chart: cicd-subsystem-application-0.1.0
      annotations:
          {}
    stringData:
      password: passw0rd
    ```