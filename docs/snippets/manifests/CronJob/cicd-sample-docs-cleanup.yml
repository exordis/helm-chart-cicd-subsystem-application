apiVersion: batch/v1
kind: CronJob
metadata:
  annotations: {}
  labels:
    app.kubernetes.io/component: cicd-sample
    app.kubernetes.io/instance: docs
    app.kubernetes.io/managed-by: helm
    app.kubernetes.io/name: cicd-sample
    app.kubernetes.io/part-of: cicd
    app.kubernetes.io/version: 0.0.0
    exordis/application: cicd-sample
    exordis/application-instance: docs
    exordis/application-type: service
    exordis/environment: test
    exordis/product: Some Product
    exordis/subsystem: cicd
    helm.sh/chart: cicd-subsystem-application-0.1.0
  name: cicd-sample-docs-cleanup
  namespace: cicd-test
spec:
  concurrencyPolicy: Forbid
  failedJobsHistoryLimit: 1
  jobTemplate:
    spec:
      template:
        metadata:
          annotations: null
          labels:
            app.kubernetes.io/component: cicd-sample
            app.kubernetes.io/instance: docs
            app.kubernetes.io/managed-by: helm
            app.kubernetes.io/name: cicd-sample
            app.kubernetes.io/part-of: cicd
            app.kubernetes.io/version: 0.0.0
            exordis/application: cicd-sample
            exordis/application-instance: docs
            exordis/application-type: service
            exordis/environment: test
            exordis/product: Some Product
            exordis/subsystem: cicd
            helm.sh/chart: cicd-subsystem-application-0.1.0
        spec:
          containers:
            - args:
                - tag
                - delete
                - --registry
              envFrom:
                - configMapRef:
                    name: cicd-sample-docs-envs
                - secretRef:
                    name: cicd-sample-docs-gitlab-token
                - secretRef:
                    name: cicd-sample-docs-secret-with-containers
                - secretRef:
                    name: cicd-sample-docs-secret-without-containers
              image: registry.gitlab.com/knst/cy/registry/cicd-docker-registry-cleaner:0.1.0
              imagePullPolicy: IfNotPresent
              name: main
              resources:
                limits:
                  cpu: 200m
                  memory: 1024Mi
                requests:
                  cpu: 2m
                  memory: 70Mi
              volumeMounts:
                - mountPath: /some-data
                  name: volume2
          initContainers:
            - envFrom:
                - configMapRef:
                    name: cicd-sample-docs-envs
                - secretRef:
                    name: cicd-sample-docs-gitlab-token
                - secretRef:
                    name: cicd-sample-docs-secret-without-containers
              image: registry.gitlab.com/cleanup-init:0.0.0
              imagePullPolicy: IfNotPresent
              name: cleanup-init
              resources:
                limits:
                  cpu: 200m
                  memory: 1024Mi
                requests:
                  cpu: 2m
                  memory: 70Mi
              volumeMounts: null
            - envFrom:
                - configMapRef:
                    name: cicd-sample-docs-envs
                - secretRef:
                    name: cicd-sample-docs-gitlab-token
                - secretRef:
                    name: cicd-sample-docs-secret-without-containers
              image: registry.gitlab.com/software-development/subsystems/some-subsystem/data-content-templates:1.24.0-dev.5
              imagePullPolicy: Always
              name: templates
              resources:
                limits:
                  cpu: 200m
                  memory: 1024Mi
                requests:
                  cpu: 2m
                  memory: 70Mi
              volumeMounts:
                - mountPath: /data/templates/generated
                  name: templates-data-templates-generated
                - mountPath: /data/templates/original
                  name: templates-data-templates-original
          restartPolicy: Never
          serviceAccountName: default
          volumes:
            - name: mypvc
              persistentVolumeClaim:
                claimName: cicd-sample-docs-mypvc
            - emptyDir:
                sizeLimit: 200Mi
              name: templates-data-templates-generated
            - emptyDir:
                sizeLimit: 200Mi
              name: templates-data-templates-original
            - emptyDir:
                sizeLimit: 100Mi
              name: volume2
      ttlSecondsAfterFinished: 86400
  schedule: 0 6 * * *
