---
order: 1
---

## Description

Entire helm chart deploys application, sacrificing some flexibility for simplicity and unification. 

Application is standalone software unit that implement specific functionality within a Subsystem. Samples of application are - micro-service, web application.

## Values

### Metadata

``` yaml
--8<-- "snippets/values/metadata.yaml"
```


Metadata values except `product` are used to build resource names with [Naming Conventions](naming conventions.md) and available in application pods as environment variables. Thus to adhere kubernetes naming constraints validated with regex `^[a-z]([-a-z0-9]*[a-z0-9])?$`

`product` is used only as reference value and represents mapping of subsystem as technical asset on organization business unit or marketing naming.

`product` value is not available for resource name construction to avoid massive kubernetes resources renaming in case of `subsystem` handover from one business unit to another or marketing naming change.

!!! NOTE
    Kubernetes has 64 characters limit for resource names, so metadata values should be as short as possible to avoid exceeding this limit, though yet not loosing clear identification.


#### Global Metadata Values

Following values are defined within global section as they belong to subsystem context. If application helm chart is deployed as part of subsystem should be provided with subsystem helm chart and be the same for all `subsystem` applications:

- `subsystem` - (mandatory) name of the `subsystem` owning the application. 
- `product` - (mandatory) name of product owning the `subsystem`.
- `environment` - `subsystem` (mandatory) environment application is being deployed to. 

#### Application Specific Metadata Values:

- `application` - (mandatory) application name
- `applicationType` - (mandatory) type of the application:
    -  `service` - microservice
    -  `web` - web application
- `instance` - (optional) name of the instance of the application. E.g. subsystem may deploy multiple application instances in sharding scenarios. If there is only one instance this field is ok to be omitted.



### Envs config map

`envs` configMap is always generated. It defines environment variables to be available in all containers of application.

#### Definition in values
```
envs:
  VARIABLE: value
```

#### Metadata environment variables

Metadata variables are added to `envs` config map. If `envs` is missing from values, config map contains only metadata:

  - `EXORDIS_PRODUCT` - subsystem product
  - `EXORDIS_SUBSYSTEM` - subsystem name
  - `EXORDIS_APPLICATION` - application canonical name as `[Values.global.subsystem]-[Values.global.application]`
  - `EXORDIS_INSTANCE` - instance name
  - `EXORDIS_ENVIRONMENT` - environment


### Workload

As application is intended to be microservice or web application there can not be more than one workload deployed. (If more is needed likely it has to be deployed independently in scope of same `subsystem` or  entire helm-chart is not applicable for the use case )

Application main workload type is set with `workload`:

  - `deployment` application should be deployed as kubernetes `Deployment`. See [Deployment](Workloads/deployment.md) for more details (default)
  - `none` no workload is to be deployed (degenerate case but may be useful in some cases if some Resources have independent lifecycle within `subsystem` )

!!! NOTE
    Support of `StatefulSet` to be added later

#### Workload Common Values

``` yaml
--8<-- "snippets/values/workload-common.yaml"
```

Values that are applicable to all types of workloads are defined on root level of values:

- `replicas` - (optional) number of pod replicas of workload. Defaults to 3
- `version` - (mandatory) version of the application. Appears as value of `app.kubernetes.io/version` label of all manifests generated by the chart
- `registry` - (optional) registry to pull  application docker images from. Defaults to `docker.io`
- `repository` - (optional)  Defaults to match application canonical name `[Values.global.subsystem]-[Values.global.application]`. 

All [containers](Components/containers.md) defined in values are using root `version`, `registry`, `repository` as default values of `image` fields.


### Entities

The remaining part of values is definition of entities that are translated to kubernetes manifests.

Entities are of following types

#### Workload components

Components of workloads. 

Application workload components are to be defined on root level of values. If `workload` value is set to `none`, such components are ignored. This ensures that application workload is only one and lets change type of application workload without significant changes in `values`

Batch workload components are to be defined as part of corresponding workload. 

- [components](Components/containers.md)
- [volumes](Components/volumes.md)

#### Resources

Standalone resources to be deployed.

- [configmap](Resources/configmap.md)
- [secret](Resources/secret.md)
- [external-secret](Resources/external-secret.md)
- [ingress](Resources/ingress.md)
- [PVC](Resources/pvc.md)
- [service](Resources/service.md)

#### Workloads

Tuning of main workload based on its type.

- [Deployment](Workloads/deployment.md)


#### Batch Workloads

Batch workloads to be deployed.

- [CronJob](Batch Workloads/cronjob.md)

### Real world sample

#### It Tools

Deployment of [it tools](https://github.com/CorentinTh/it-tools) - set of IT tools like IPv4 address converter and Base64 string encoder/decoder.

``` yaml
global:
  environment: prod
  product: cicd
  subsystem: samples

application: it-tools

registry: docker.io
repository: corentinth/it-tools
replicas: 1
version: 2024.10.22-7ca5933


applicationContainer:
  spec:
    livenessProbe:
      httpGet:
        path: /favicon.ico
        port: 80
    ports:
      - containerPort: 80
        name: http
        protocol: TCP
    readinessProbe:
      httpGet:
        path: /favicon.ico
        port: 80
    startupProbe:
      httpGet:
        path: /favicon.ico
        port: 80

ingresses:
  ui:
    services:
      ui:
        hosts:
          - it-tools.local
        ports:
          http:
            - path: /
services:
  ui:
    ports:
      http: {}
```

#### Homepage

Deployment of [Homepage](https://gethomepage.dev/) dashboard


``` yaml
global:
  environment: prod
  product: cicd
  subsystem: samples
application: homepage

registry: ghcr.io
replicas: 1
repository: gethomepage/homepage
version: v0.10.9

envs:
  HOMEPAGE_VAR_UNIFI_PASSWORD: "passw0rd"
  HOMEPAGE_VAR_UNIFI_USERNAME: "homepage"

configMaps:
  config:
    containers: []
    data:
      bookmarks.yaml: '{}'
      docker.yaml: '{}'
      kubernetes.yaml: '{}'
      services.yaml: '{}'
      settings.yaml: '{}'
      widgets.yaml: |
        - unifi_console:
            password: '{{HOMEPAGE_VAR_UNIFI_PASSWORD}}'
            url: https://unifi.local
            username: '{{HOMEPAGE_VAR_UNIFI_USERNAME}}' 

applicationContainer:
  spec:
    ports:
      - containerPort: 3000
        name: http
        protocol: TCP
    livenessProbe:
      failureThreshold: 3
      periodSeconds: 10
      successThreshold: 1
      tcpSocket:
        port: 3000
      timeoutSeconds: 1
    readinessProbe:
      failureThreshold: 3
      periodSeconds: 10
      successThreshold: 1
      tcpSocket:
        port: 3000
      timeoutSeconds: 1
    startupProbe:
      failureThreshold: 30
      periodSeconds: 5
      successThreshold: 1
      tcpSocket:
        port: 3000
      timeoutSeconds: 1
    terminationMessagePath: /dev/termination-log
    terminationMessagePolicy: File

initContainers:
  copy-config:
    image:
      registry: docker.io
      repository: alpine
      version: 3.21.3
    spec:
      command:
        - sh
        - '-c'
        - |
          cp -Lr /config-ro/* /config/

volumes:
  config:
    mounts:
      application: /app/config
      copy-config: /config
  config-ro:
    configMap: config
    mounts:
      copy-config: /config-ro
  logs:
    mounts:
      application: /app/config/logs          

services:
  ui:
    ports:
      http: {}

ingresses:
  ui:
    services:
      ui:
        hosts:
          - homepage.local
        ports:
          http:
            - path: /
```