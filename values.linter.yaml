application: some-application
applicationType: service
dockerRegistry: registry.gitlab.com
instanceName: some-instancename

version: 0.0.0
# workload: deployment
# workload: none

replicas: 3
global: 
  product: Some Product
  subsystem: some-subsystem
  environment: test
externalSecretScope: qa2
externalSecretsStrategy: latest

envs: 
  TEST: 123
  SUBSYSTEM: wrong-subsystem

deployment:
  strategy:
    rollingUpdate:
      maxSurge: 25%
      maxUnavailable: 25%
    type: RollingUpdate


configMaps:
  config:
    data:
      test: "123"
      
applicationContainer: {}


serviceMonitorKeys:
  username: Metrics__Authentication__Username
  password: Metrics__Authentication__Password

services:
  service-a:
    #spec:
    monitor: {}
    ports:
      8080: # name: default [service name]-[port]
        targetPort: 8080
      8081: # name: default [service name]-[port]
        targetPort: 8080
  service-b:
    ports:
      8181: # name: default [service name]-[port]
        targetPort: 8080 # target port

ingresses:
  internal:
    default_backend:
      service: service-a #validate service + port exist
      port: 80  #validate service + port exist
    useTls: true
    hosts:
      - k3s.local
    paths:
      - path: /api/v3(/|$)(.*)
        pathType: Prefix
      - path: /
        pathType: Prefix
  public:          
    type: public
    default_backend:
      service: service-b #validate service + port exist
      port: 80
    useRegex: true
    rewriteTarget: /$2
    proxyBuffering: false
    proxyBodySize: 0
    annotations:
      aaa: '1'
    hosts:
      - service-api.exordis.com
      - service-api2.exordis.com
    paths:
      - path: /public-api-one
        pathType: Prefix
        backend:
          service: service-b
          port: 80
      - path: /public-api-two
        pathType: Prefix
    spec:
      ingressClassName: nginx



initContainers:
  migration:
    image: my-default-image
    version: 0.0.0
    #spec:
    #  imagePullPolicy: Always

sidecars:
  jsreport:
    image: jsreport
    version: 0.0.0
    #spec:

#TODO: replace with dict name->spec
volumes:
  volume1:
    #spec:
    #type: emptyDir
    mounts: 
      applicationContainer: /some-data
      jsreport: /some-another-data-but-same-as-for-applicationContainer

pvcs:
  mypvc:
    size: 10Gi
    mounts: 
      applicationContainer: /pvc-data
    spec: 
      resources:
        requests:
          storage: 100Gi


dataFolders:
  content:
    "templates":
      spec:
        imagePullPolicy: Always
      version: 1.24.0-dev.5
      sizeLimit: 200Mi
      mounts: #shouldn't be empty
        applicationContainer:
          "/data/templates/original": null #use key by default or /data/templates/original
          "/data/templates/generated": /data/templates/generated
        jsreport:
          "/data/templates/generated": /jsreport

externalSecrets:
  gitlab-token:
    spec:
      target:
        creationPolicy: Owner
        template:
          engineVersion: v2
          data:
            GITLAB_PYPI_REGISTRY_LOGIN: "{{ `{{ .login }}` }}"               
            GITLAB_PYPI_REGISTRY_PASSWORD: "{{ `{{ .password }}` }}"               
      data:
        - secretKey: login
          remoteRef:
            key: GITLAB_PYPI_REGISTRY_LOGIN
        - secretKey: password
          remoteRef:
            key: GITLAB_PYPI_REGISTRY_PASSWORD

cronjobs:
  cleanup:
    schedule: 0 6 * * *
    containers:
      main: 
        image: "registry.gitlab.com/knst/cy/registry/cicd-docker-registry-cleaner"
        version: "0.1.0"
        spec:
          args: 
            - "tag" 
            - "delete"
            - "--registry"
    initContainers:
      "cleanup-init":
        image: cleanup-init
        version: 0.0.0            
    volumes:
      volume2:
        #spec:
        #type: emptyDir
        mounts: 
          main: /some-data
