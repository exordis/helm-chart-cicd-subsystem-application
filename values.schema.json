{
  "$schema": "https://json-schema.org/schema#",
  "type": "object",
  "required": [
      "application",
      "applicationType",
      "global"
  ],
  "properties": {
      "sdk": {
          "type": "object"
      },
      "foundation-sdk": {
          "type": "object"
      },
      "workload": {
        "type": "string",
        "enum": [
            "deployment",
            "none"
        ]
      },      
      "global": {
          "type": "object",
          "required": [
              "product",
              "subsystem",
              "environment"
          ],
          "properties": {
              "product": {
                  "type": "string",
                  "pattern": "^[A-Za-z0-9][A-Za-z0-9-]+[A-Za-z0-9]([- ][A-Za-z0-9][A-Za-z0-9-]+[A-Za-z0-9])*$"
              },
              "subsystem": {
                  "type": "string",
                  "pattern": "^[a-z]([-a-z0-9]*[a-z0-9])?$"
              },
              "environment": {
                  "type": "string",
                  "pattern": "^[a-z]([-a-z0-9]*[a-z0-9])?$"
              }
          }
      },
      "application": {
          "type": "string",
          "pattern": "^[a-z]([-a-z0-9]*[a-z0-9])?$"
      },
      "applicationType": {
          "type": "string",
          "enum": [
              "service",
              "web"
          ]
      },
      "applicationContainer": {
          "type": "object"
      },
      "replicas": {
          "type": "integer"
      },
      "dockerRegistry": {
          "type": "string"
      },
      "instanceName": {
          "type": "string"
      },
      "image": {
          "type": "string"
      },
      "certManagerClusterIssuer": {
          "type": "string",
          "pattern": "^[a-z]([-a-z0-9]*[a-z0-9])?$"
      },
      "version": {
          "$ref": "#/definitions/dockerImageVersion"
      },
      "deployment": {
        "$ref": "#/definitions/deployment"
      },
      "envs": {
          "type": "object",
          "patternProperties": {
              "^\\S+$": {
                  "type": [
                      "string",
                      "integer"
                  ]
              }
          },
          "additionalProperties": false
      },
      "initContainers": {
          "type": "object",
          "patternProperties": {
              "^[a-z]([-a-z0-9]*[a-z0-9])?$": {
                  "$ref": "#/definitions/container"
              }
          },
          "additionalProperties": false
      },
      "dataFolders": {
          "type": "object",
          "properties": {
              "configuration": {
                  "type": "object",
                  "patternProperties": {
                      "^[a-z]([-a-z0-9]*[a-z0-9])?$": {
                          "$ref": "#/definitions/dataFolder"
                      }
                  },
                  "additionalProperties": false
              },
              "content": {
                  "type": "object",
                  "patternProperties": {
                      "^[a-z]([-a-z0-9]*[a-z0-9])?$": {
                          "$ref": "#/definitions/dataFolder"
                      }
                  },
                  "additionalProperties": false
              }
          },
          "additionalProperties": false
      },
      "secrets": {
          "type": "object",
          "patternProperties": {
              "^[a-z]([-a-z0-9]*[a-z0-9])?$": {
                  "$ref": "#/definitions/secret"
              }
          },
          "additionalProperties": false
      },
      "externalSecrets": {
          "type": "object",
          "patternProperties": {
              "^[a-z]([-a-z0-9]*[a-z0-9])?$": {
                  "$ref": "#/definitions/externalSecret"
              }
          },
          "additionalProperties": false
      },
      "configMaps": {
          "type": "object",
          "patternProperties": {
              "^[a-z]([-a-z0-9]*[a-z0-9])?$": {
                  "oneOf": [
                      {"type": "null"},
                      {"$ref": "#/definitions/configMap"}
                  ]                
              }
          },
          "additionalProperties": false
      },
      "sidecars": {
          "type": "object",
          "patternProperties": {
              "^[a-z]([-a-z0-9]*[a-z0-9])?$": {
                  "$ref": "#/definitions/container"
              }
          },
          "additionalProperties": false
      },
      "volumes": {
          "type": "object",
          "patternProperties": {
              "^[a-z]([-a-z0-9]*[a-z0-9])?$": {
                  "$ref": "#/definitions/volume"
              }
          },
          "additionalProperties": false
      },
      "services": {
          "type": "object",
          "patternProperties": {
              "^[a-z]([-a-z0-9]*[a-z0-9])?$": {
                  "$ref": "#/definitions/service"
              },
              "additionalProperties": false
          },
          "additionalProperties": false
      },
      "ingresses": {
          "type": "object",
          "additionalProperties": {
              "$ref": "#/definitions/ingress"
          }
      },
      "pvcs": {
        "type": "object",
        "additionalProperties": {
            "$ref": "#/definitions/pvc"
        }
      },
      "cronjobs": {
        "type": "object",
        "patternProperties": {
            "^[a-z]([-a-z0-9]*[a-z0-9])?$": {
                "$ref": "#/definitions/cronjob"
            }
        },
        "additionalProperties": false
      },      
      "__test_injected_code_variable": {
          "type": "string"
      }
  },
  "additionalProperties": false,
  "definitions": {
      "configMap": {
          "type": "object",
          "properties": {
              "namespace": {
                  "type": "string"
              },
              "data": {
                  "type": "object",
                  "patternProperties": {
                      "^[a-zA-Z_][-a-zA-Z0-9_]+$": {
                          "type": "string"
                      }
                  }
              },
              "additionalProperties": false
          }
      },
      "cronjob": {
        "type": "object"
      },

      "secret": {
          "type": "object",
          "properties": {
              "containers": {
                  "type": "array",
                  "items": {
                      "type": "string"
                  }
              },
              "namespace": {
                  "type": "string"
              },
              "stringData": {
                  "type": "object",
                  "patternProperties": {
                      "^[a-zA-Z_][-a-zA-Z0-9_]+$": {
                          "type": "string"
                      }
                  }
              }
          }
      },
      "externalSecret": {
          "type": "object",
          "properties": {
              "key": {
                  "type": "string",
                  "pattern": "^[a-z]([-a-z0-9]*[a-z0-9])?$"
              },            
              "targetSecretName": {
                  "type": "string",
                  "pattern": "^[a-z]([-a-z0-9]*[a-z0-9])?$"
              },            
              "containers": {
                  "type": "array",
                  "items": {
                      "type": "string"
                  }
              },
              "spec": {
                "type": "object"
              }
          }
      },
      "dataFolder": {
          "type": "object",
          "properties": {
              "spec": {
                  "type": "object"
              },
              "version": {
                  "$ref": "#/definitions/dockerImageVersion"
              },
              "sizeLimit": {
                  "type": "string"
              },
              "mounts": {
                  "type": "object",
                  "patternProperties": {
                      "^[a-zA-Z]+$": {
                          "type": "object",
                          "patternProperties": {
                              "^\/.*$": {
                                  "$ref": "#/definitions/nullableAbsolutePath"
                              }
                          },
                          "additionalProperties": false
                      }
                  },
                  "additionalProperties": false
              }
          },
          "additionalProperties": false
      },
      "ingressBackend": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
              "service": {
                  "type": "string",
                  "pattern": "^[a-z]([-a-z0-9]*[a-z0-9])?$"
              },
              "port": {
                  "type": "integer"
              },
              "foreign": {
                  "type": "boolean"
              }
          },
          "required": [
              "port",
              "service"
          ]
      },
      "pvc": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "size": {
                "type": "string",
                "pattern": "^[1-9][0-9]*(\\.[0-9]+)?(E|P|T|G|M|k|Ei|Pi|Ti|Gi|Mi|Ki)$"
            },            
            "spec": {
                "type": "object"
            },
            "mounts": {
                "$ref": "#/definitions/nonEmptyMounts"
            }
        }
      },
      "ingress": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
              "type": {
                  "type": "string",
                  "enum": [
                      "public",
                      "internal"
                  ]
              },
              "default_backend": {
                  "$ref": "#/definitions/ingressBackend"
              },
              "rewriteTarget": {
                  "type": "string"
              },
              "proxyBodySize": {
                  "type": "integer"
              },
              "proxyBuffering": {
                  "type": "boolean"
              },
              "useRegex": {
                  "type": "boolean"
              },
              "useTls": {
                  "type": "boolean"
              },
              "hosts": {
                  "type": "array",
                  "items": {
                      "type": "string"
                  }
              },
              "annotations":{
                "type": "object",
                "patternProperties": {
                    "^.+$": {
                        "type": "string"
                    }
                }
              },
              "paths": {
                  "type": "array",
                  "items": {
                      "type": "object",
                      "additionalProperties": false,
                      "properties": {
                          "path": {
                              "type": "string"
                          },
                          "pathType": {
                              "type": "string"
                          },
                          "backend": {
                              "$ref": "#/definitions/ingressBackend"
                          }
                      },
                      "required": [
                          "path"
                      ]
                  }
              },
              "spec": {
                  "type": "object"
              }
          },
          "required": [
              "hosts",
              "paths"
          ]
      },
      "volume": {
          "type": "object",
          "required": [],
          "properties": {
              "name": {
                  "type": "string"
              },
              "type": {
                  "type": "string",
                  "enum": [
                    "emptyDir"
                    ]
              },
              "spec": {
                  "type": "object"
              },
              "mounts": {
                "$ref": "#/definitions/nonEmptyMounts"
            }

          },
          "additionalProperties": false
      },
      "service": {
          "type": "object",
          "properties": {
              "targetPort": {
                  "type": "integer"
              }
          }
      },
      "dockerImageVersion": {
          "type": "string",
          "pattern": "^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$"
      },
      "deployment": {
          "type": "object",
          "properties": {
              "strategy": {
                  "type": "object"
              }
            },
          "additionalProperties": false  
      },
      "mounts":{
        "type": "object",
        "patternProperties": {
            "^[a-zA-Z]+$": {
                "$ref": "#/definitions/absolutePath"
            }
        },
        "additionalProperties": false
      },
      "nonEmptyMounts":{
        "allOf": [
            { "$ref": "#/definitions/mounts" },
            { "minProperties": 1 }
            ]
      },
      "nullableAbsolutePath": {
          "type": [
              "string",
              "null"
          ],
          "pattern": "^\/.*$"
      },
      "absolutePath": {
          "type": [
              "string"
          ],
          "pattern": "^\/.*$"
      },
      "container": {
          "type": "object",
          "properties": {
              "image": {
                  "type": "string"
              },
              "version": {
                  "$ref": "#/definitions/dockerImageVersion"
              },
              "spec": {
                  "type": "object"
              }
          }
      }
  }
}